---
layout:     post
title:      JavaåŸºç¡€çŸ¥è¯†
subtitle:    "\"Java Basis\""
date:       2019-10-30
author:     Jimmy
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - JavaåŸºç¡€
    - Javaè¯­æ³•
    - Java
    - é¢è¯•
---

> â€œğŸ™‰ğŸ™‰ğŸ™‰ â€

## å‰è¨€
è¿™ç¯‡åšæ–‡ä¸»è¦è®°å½•ä¸‹Javaé¢è¯•ä¸­å¸¸è§çš„é—®é¢˜åŠåŸºç¡€çŸ¥è¯†ã€‚


## æ­£æ–‡

### HashMap

åŸºäºMapæ¥å£å®ç°ï¼Œå…è®¸nullé”®/å€¼ã€éåŒæ­¥ã€ä¸ä¿è¯æœ‰åºã€ä¹Ÿä¸ä¿è¯åºå·ä¸éšæ—¶é—´å˜åŒ–ã€‚

ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼šå®¹é‡(Capacity)å’Œè´Ÿè½½å› å­(Load factor)

ç®€å•çš„è¯´ï¼ŒCapacityå°±æ˜¯bucketsçš„æ•°ç›®ï¼ŒLoad factorå°±æ˜¯bucketså¡«æ»¡ç¨‹åº¦çš„æœ€å¤§æ¯”ä¾‹ã€‚å¦‚æœå¯¹è¿­ä»£æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„è¯ä¸è¦æŠŠcapacityè®¾ç½®è¿‡å¤§ï¼Œä¹Ÿä¸è¦æŠŠload factorè®¾ç½®è¿‡å°ã€‚å½“bucketå¡«å……çš„æ•°ç›®ï¼ˆå³hashmapä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰å¤§äºcapacity*load factoræ—¶å°±éœ€è¦è°ƒæ•´bucketsçš„æ•°ç›®ä¸ºå½“å‰çš„2å€ã€‚

#### putå‡½æ•°çš„å®ç°

putå‡½æ•°å¤§è‡´çš„æ€è·¯ä¸ºï¼š

> 1. å¯¹keyçš„hashCode()åšhashï¼Œç„¶åå†è®¡ç®—index;
> 1. å¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ°bucketé‡Œï¼›
> 1. å¦‚æœç¢°æ’äº†ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨bucketsåï¼›
> 1. å¦‚æœç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿(å¤§äºç­‰äºTREEIFY_THRESHOLD)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼›
> 1. å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢old value(ä¿è¯keyçš„å”¯ä¸€æ€§)
> 1. å¦‚æœbucketæ»¡äº†(è¶…è¿‡load factor*current capacity)ï¼Œå°±è¦resizeã€‚

ä»£ç å®ç°ï¼š
```
public V put(K key, V value) {
    // å¯¹keyçš„hashCode()åšhash
    return putVal(hash(key), key, value, false, true);
}
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    // tabä¸ºç©ºåˆ™åˆ›å»º
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    // è®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç†
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;
        // èŠ‚ç‚¹å­˜åœ¨
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
        // è¯¥é“¾ä¸ºæ ‘
        else if (p instanceof TreeNode)
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        // è¯¥é“¾ä¸ºé“¾è¡¨
        else {
            for (int binCount = 0; ; ++binCount) {
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        // å†™å…¥
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;
    // è¶…è¿‡load factor*current capacityï¼Œresize
    if (++size > threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
```
